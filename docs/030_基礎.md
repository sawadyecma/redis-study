# 基礎

## データタイプ
Redisではキーと値を紐づけて保存する。
Redisと他の構造型ストレージの重要な違いとして、Redisはバイナリ列(string)だけでなく、以下のようなデータタイプをサポートする。
Redisではバイナリ列のことをstringと呼んでいるが、特定の文字に限った物ではない。

- バイナリ列(string)のリスト
- バイナリ列(string)の集合(ソートされない重複のないコレクション)
- バイナリ列(string)のソートされた集合(浮動小数点数のスコアによりソートされた重複のないコレクション)
- バイナリ列(string)のキーと値からなるハッシュテーブル
- ビットマップ → ?
- 集合の濃度 → ?

値のデータタイプは、各タイプごとに用意された操作(コマンド)で決定される。
セットやリストの差分抽出といったサーバーサイド操作をアトミックにサポートする。

## 永続性

Redisでは一般的に全てのデータはメモリ上に格納される。
バージョン2.4によりバーチャルメモリ(ディスク上の格納)が使用可能になったが、これは非推奨。
永続性を実現する手段としては、現在2つの方法が用意されている。

### 1つめ: スナップショット
メモリ上のデータは非同期で時折RDBダンプの形式でディスク上に書き込まれる。
SAVEコマンドを使う。

### 2つめ: AOF(append-only file)
メモリ上のデータが書き込まれる度にトランザクションログが書き込まれる安全な方式
Redisはトランザクションログ肥大化防止のためにバックグラウンドでこれを再生成可能。
データベースのWAL/REDOログに似た書き込みログ。
`appendfsync everysec`: デフォルトで1秒ごとにfsyncによりディスクに同期されるため、データを失う期間は1秒以内に制限される。
`appendfsync always`: では、1回の書き込みごとfsyncの呼び出すも可能だが、処理が遅くなる


スナップショットでは、サーバープロセスの障害が発生した場合、直近数分程度のデータを失う。

デフォルトではRedisは2秒間隔でデータをファイルシステムに書き込むようになっている。

## レプリケーション

マスタースレーブ型のレプリケーションをサポート
複数台のスレーブにレプリケーションすることができる
スレーブはまた別のスレーブのマスターとなれる
シングルルートレプリケーションをサポートする。
→ 他にどんなレプリケーション手法があるのか？
Redisのスレーブには書き込みを許可する設定も可能で、その場合、インスタンス間の不整合を許容する形になる。
RedisはPub-Sub型モデルを完全に実装しており、マスターでPublish異種されたメッセージはスレーブに接続してSubscribeしているクライアントにも到達する・レプリケーションは。読み込みのスケーラビリティとデータの冗長性向上に有効である。

## 性能
データの永続性が必要ない場合において、ディスクIOがあるDBと比べて優位。
Redisの操作はシングルスレッド上のシングルプロセスとして動作する。
そのため、1つのRedisインスタンスでは、例えばストアドプロシージャのように並列処理の実行は不可

→ いまいちしっくり来ない説明

## クラスタリング
Redisプロジェクトはクラスター仕様を持っており、キー空間の自動パーティショニングとホットリシャーディングをサポート。
ただし、シングルキー操作のみに対応らしい。



## 用語

|名前|説明|
|----|----|
|シャーディング|複数のサーバを使用して単一の論理データベースを構成する手法|