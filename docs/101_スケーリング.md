# クラスターモードが有効

## オフラインの再分散とシャードの再分散

メリット

- レプリケーショングループのノードタイプ変更
- 各ノードへのAZ指定
- エンジンバージョン更新
- 各シャードでのレプリカノード数の指定
- 各シャードのキースペース指定

デメリット

- 復元処理の開始からオフラインになり、アプリケーションのエンドポイントを更新するまで継続すること

## オンライン再分散とシャードの再分散
ダウンタイムなしでスケール可能。
スケーリングや再分散が処理中でもリクエストに継続対応が可能。
スケールアウト/スケールイン/再分散(キースペースを等分に移動)

シャードのキースペースの個別指定は不可
リシャーディングはオペレーションコストがそれなりにかかるので、オフピーク時に実施すべき

## オンラインスケールアップ
Redis クラスターは最小限のダウンタイムでリクエストを処理し続ける

## オンラインスケールダウン
Redis クラスターは最小限のダウンタイムでリクエストを処理し続けます。

# AutoScaling

以下2つの併用が推奨されている?

- ターゲット追跡スケーリング
- スケジュールに基づくスケーリング

## シャードのAutoScaling

### ターゲット追跡スケーリング
- `ElastiCachePrimaryEngineCPUUtilization`はクラスター内すべてのプライマリーノ-ードでの`EngineCPUUtilization`の平均値を取る。
- `ElastiCacheDatabaseMemoryUsageCountedForEvictPercentage`クラスター内すべてのノードでの`DatabaseMemoryUsageCountedForEvictPercentage`の平均値

`ElastiCachePrimaryEngineCPUUtilization`がターゲット値以上を検出すると、シャードの容量が自動増加する。
→ スケールアウトでは、値の変動率分だけ、シャード数も増えるが、最小は20%分。
    例: 50シャードあって30%超過した場合、65シャードになる
    例: 50シャードあって10%超過した場合、20%分スケールアウトするため、60シャードになる。
→ スケールインでは、閾値の75％以下になったときにスケールインする
    例: 60%を指定した場合、45%以下になるとスケールイン

スケールインは抑制されている
手動でも変更できるが、メトリクスに影響する可能性あり
redisのノード数の制限(90)は増加リクエスト可能。


### スケジュールに基づくスケーリング
- 需要変化を予測できる


